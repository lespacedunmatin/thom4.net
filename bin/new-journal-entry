#!/usr/bin/env node

const {choose, prompt, confirm} = require('promptly')
const H = require('hexo')
const hexo = new H(process.cwd(), {})

const optional = (value) => value || ''

hexo.init().then(async () => {
  const title = await prompt('Title: ')
  const lang = await choose('Lang: ', ['fr-FR', 'en-GB'], {default: 'fr-FR'})
  const categories = ['Journal'].concat((await prompt('Categories: ', {validator: [optional]})).split(','))
  const content = await prompt('Body: ')

  return {title, content, categories, lang}
})
.then(async (initialData) => {
  const data = { ...initialData, layout: 'journal' }

  return hexo.post.create(data, {replace: false})
})
.catch(error => {
  // manually cancelled prompts do no throw
  if (error.message.match('canceled')) {
    return true
  }

  throw error
})
